%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% LATEX-TEMPLATE TECHNISCH RAPPORT
%-------------------------------------------------------------------------------
% This template is derived from the AVI PT report template.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%-------------------------------------------------------------------------------
%	PACKAGES EN DOCUMENT CONFIGURATIE
%-------------------------------------------------------------------------------

\documentclass{uva-inf-article}
%\usepackage[dutch]{babel}
%\usepackage{csquotes}

\usepackage[style=numeric-comp]{biblatex}
\addbibresource{PT-essay.bib}
\usepackage{listings}
%-------------------------------------------------------------------------------
%	GEGEVENS VOOR IN DE TITEL
%-------------------------------------------------------------------------------

% Vul de naam van de opdracht in.
\assignment{Compiler Construction}
% Vul het soort opdracht in.
\assignmenttype{Essay}
% Vul de titel van de eindopdracht in.
\title{CiviC Compiler Report}

% Vul de volledige namen van alle auteurs in.
\author{RenÃ© Kok}
\uvanetid{13671146}

\author{Aram Mutlu}
\uvanetid{13574116}

% Vul eventueel ook de naam van de docent of vakcoordinator toe.
\docent{Dhr. dr. C.U. Grelck}
\course{Compiler Construction}
% Te vinden op onder andere Datanose.
\courseid{5062COMP6Y}

% Dit is de datum die op het document komt te staan. Standaard is dat vandaag.
\date{\today}

%-------------------------------------------------------------------------------
%	VOORPAGINA
%-------------------------------------------------------------------------------

\begin{document}
\maketitle

%-------------------------------------------------------------------------------
%	INHOUDSOPGAVE EN ABSTRACT
%-------------------------------------------------------------------------------

% Niet doen bij korte verslagen en rapporten
%\tableofcontents
%\begin{abstract}
%\lipsum[13]
%\end{abstract}

%-------------------------------------------------------------------------------
%	INTRODUCTIE
%-------------------------------------------------------------------------------

\section{Introduction}
\par This report provides information regarding the CiviC compiler we build in 
the course Compiler Construction by dr. C.U. Grelck. The goal of the CiviC compiler 
is to create a CiviC compiler that transforms CiviC code into CiviC assembly code 
that a computer can understand. In this report we will focus on different aspects 
of our compiler and what we did and how we did it. We will do this by following the order of the milestones,
from scanning/parsing to code generation and also use the milestones to further 
explain the compiler.

% TODO: Schrijf dat we geen extensies hebben toegevoegd en/of optimalizaties buiten de standaard milestones om.

%-------------------------------------------------------------------------------
%	METHODE
%-------------------------------------------------------------------------------
\newpage
\section{Lexicographic Analysis}
The first step for building a CiviC compiler is to create (or extend in this case) 
the scanner that reads the CiviC code (stream of characters) that recognizes the 
symbols and words and outputs a (finite) stream of tokens.
By recognizing the words and symbols the Scanner can use pattern matching to find see
what the next action will be for the compiler. For the scanner to know which symbols
are available in the CiviC language, we need to define these ourselves. We did this 
by defining all the possible symbols (parenthesis, brackets and binary operators etc.)
which are supported by the CiviC language. The CiviC language only supports integers,
floats and booleans so there is no need to define other types in the compiler.

% TODO: vertel dat we #include "limits.h" hebben gebruikt voor de min en max.
% ^Done, maar niet zeker of t goed is hieronder
In our scanner we added a validator that validates if an integer is too large or too small by 
comparing it to the max int and min int. We included the "limits.h" file in our civic.l
to get the values of min and max. If the integer is too high or too low the compiler
returns an CTIerror telling the integer is out of range.

\begin{lstlisting}[basicstyle=\small, language=C, label=lst:code, caption=Integer range check, captionpos=b]
    [0-9]+      { long integer = strtol(yytext, NULL, 10);
                    if (integer > INT_MAX || integer < INT_MIN) {
                        CTIerror("Integer %s out of range", yytext);
                    }
                    else
                    {
                        yylval.cint=atoi(yytext);
                        FILTER( INTVAL);
                    }
                }
\end{lstlisting}

% TODO: Extra check max float value.


% TODO: Milestone 2
After completing the scanner we needed to refine our intermediate representation (abstract
syntax tree) for our compiler. We used the AST that was provided by school and added some 
elements of our own. To make the SymbolTable work properly we added the SymbolTable to the
AST along with the SymbolTableEntry. A SymbolTableEntry contains all the information about 
an entry such as in which SymbolTable its stored in, name, type, if its a function/parameter/export,
its offset, depth and its definition. We did the same for the CodeGenTable and the CodeGenTableEntry.
The CodeGenTableEntry stores information for a single line of code generation such as the
index, instruction and the value of the generated code. Code generation will be further 
explained in section 6 of this report.

% TODO: (Expand) Milestone 3
To properly illustrate the logical structure of the code we had to expand the print traversals
to cover the full syntactic range of the CiviC language. Each node in the AST has its own
print traversal which prints the information of that node.



\newpage
\section{Syntatic Analysis}
After the scanner is done and creates a (finite) stream of tokens, the parser comes
into play and will start its job. The parser will use the output from the scanner and
use it to create and output a abstract syntax tree (AST). The parser uses the stream 
of tokens to do pattern matching with the pre defined casus in the compiler. 

% TODO: (Example with CiviC code + pattern matching behind it: int X; // Type ID SEMICOLON (vardecl))

\section{Semantic Analysis}
%\lipsum[7]

\section{Optimization}
%\lipsum[7]

\section{Code Generation}
%\lipsum[7]

\section{Conclusion/Discussion/Reflection}
\par The last section of your report should be reflective and could be called
anything along the lines of Conclusions, Discussion or Reflection. 

%-------------------------------------------------------------------------------
%	REFERENTIES
%-------------------------------------------------------------------------------

%\printbibliography

%-------------------------------------------------------------------------------
%	BIJLAGEN EN EINDE
%-------------------------------------------------------------------------------

%\section{Bijlage A}
%\section{Bijlage B}
%\section{Bijlage C}
\end{document}
